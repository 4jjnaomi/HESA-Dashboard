def create_scatter_mapbox(region=None, hei=None):
    hei_data = Path(__file__).parent.parent.joinpath('data', 'hei_data.csv')
    cols = ['UKPRN', 'HE Provider', 'Region of HE provider', 'lat', 'lon']
    df_loc = pd.read_csv(hei_data, usecols=cols)

    if region:
        df_loc = df_loc[df_loc['Region of HE provider'].isin(region)]
    if hei:
        df_loc = df_loc[df_loc['HE Provider'].isin(hei)]

    # Define a color scale using px.colors.qualitative.Set3
    color_scale = px.colors.qualitative.Set3

    df_loc['MarkerSize'] = 5

    fig = px.scatter_geo(
        df_loc,
        lat="lat",
        lon="lon",
        color="Region of HE provider",
        hover_name="HE Provider",
        hover_data={"Region of HE provider": False, "lat": False, "lon": False, 'MarkerSize': False},
        custom_data=["UKPRN"],
        opacity=0.8,
        color_continuous_scale=color_scale,
        projection="mercator",
        width=800,
        height=800,
        size = 'MarkerSize'
    )

    fig.update_geos(
        resolution=50,
        showland=True,
        landcolor='rgb(220, 220, 220)'
    )

    fig.update_layout(
        title='HE Providers by Region',
        geo=dict(
            fitbounds="locations",
            showcoastlines=True,  # Show coastlines
            showland=True,  # Show land
            showcountries=True,  # Show country borders
            countrycolor="black",  # Border color for countries
            showrivers=True,  # Show rivers
            rivercolor="blue",  # River color
            showlakes=True,  # Show lakes
            lakecolor="rgb(0, 255, 255)",  # Lake color
        )
    )

    return fig